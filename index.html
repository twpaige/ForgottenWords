<!--
  Forgotten Words – Version 9.6
  Features:
  - Terminal-style private text box
  - Single-character masking beyond buffer
  - Adjustable buffer (min 3, max 250, default 50) via slider
  - Adjustable idle timer (min 2s, max 60s, default 5s) via slider
  - Fade-out on idle or Enter key
  - Countdown timer display with current/max format
  - Countdown line also shows buffer value
  - Scripture fragment: Hebrews 8:12
  - Tooltip explaining purpose
  - Focus on load
  - Fully monochrome / black & white with light gray sliders
  - Fade cancel on typing
  - Sliders prevent wrapping of labels
  - Idle timer updates correctly when slider is changed mid-session
-->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Forgotten Words</title>
<style>
body {
  margin: 0;
  height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  background: #f5f5f5;
  font-family: monospace;
  color: #222;
}

h1 {
  margin: 0;
  font-size: 24px;
  font-weight: normal;
}

#subtitle {
  margin-top: 4px;
  margin-bottom: 8px;
  font-size: 14px;
  color: #555;
  display: flex;
  align-items: center;
  gap: 6px;
}

#scripture {
  margin-top: 10px;
  margin-bottom: 10px;
  font-size: 12px;
  color: #777;
  text-align: center;
  line-height: 1.4;
}

.info {
  position: relative;
  display: inline-flex;
  justify-content: center;
  align-items: center;
  width: 16px;
  height: 16px;
  border: 1px solid #777;
  border-radius: 50%;
  font-size: 11px;
  cursor: default;
  color: #555;
}

.info:hover .tooltip,
.info:focus-within .tooltip {
  opacity: 1;
  pointer-events: auto;
}

.tooltip {
  position: absolute;
  top: 22px;
  left: 50%;
  transform: translateX(-50%);
  width: 260px;
  padding: 8px;
  background: #fff;
  border: 1px solid #ccc;
  font-size: 12px;
  line-height: 1.4;
  color: #333;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s ease;
  z-index: 10;
}

#controls {
  margin-top: 6px;
  margin-bottom: 6px;
  text-align: center;
  font-size: 12px;
  color: #777;
}

#countdown {
  display: block;
  margin-bottom: 6px;
}

.slider-container {
  width: 80ch;
  margin-bottom: 6px;
}

.box {
  width: 80ch;
  height: calc(1.2em * 12);
  border: none;
  font-size: 16px;
  line-height: 1.2em;
  outline: none;
  display: flex;
  justify-content: flex-start;
  align-items: flex-start;
  text-align: left;
  white-space: pre-wrap;
  overflow-wrap: break-word;
  padding: 6px;
  opacity: 1;
  transition: opacity 1.5s ease;
}

.box.fading {
  opacity: 0;
}

.box:empty::before {
  content: "type here";
  color: #999;
}

/* Slider styling - light gray */
input[type=range] {
  -webkit-appearance: none;
  width: 100%;
  height: 8px;
  background: #ccc;
  border-radius: 4px;
  outline: none;
  cursor: pointer;
}

input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 16px;
  height: 16px;
  background: #888;
  border-radius: 50%;
  border: none;
  margin-top: -4px;
}

input[type=range]::-moz-range-thumb {
  width: 16px;
  height: 16px;
  background: #888;
  border-radius: 50%;
  border: none;
}

input[type=range]::-moz-range-track {
  background: #ccc;
  height: 8px;
  border-radius: 4px;
}
</style>
</head>
<body>

<h1>Forgotten Words</h1>

<div id="subtitle">
  <span>Words given to God, then released.</span>
  <span class="info" tabindex="0">
    i
    <span class="tooltip">
      A private space for prayer, confession, reflection, and release.
      Nothing is saved. Words are offered, then fade away. The Lord is 
      good, he forgives and forgets your offenses. Do not cling to them 
      yourself, let them go and ask the Lord for more faith and righteousness.
    </span>
  </span>
</div>

<hr style="border:none;height:1px;background-color:#777;width:5%;margin:8px 0;">

<div id="scripture">
  “…and will remember their sins no more.”<br>
  <span>Hebrews&nbsp;8:12</span>
</div>

<hr style="border:none;height:1px;background-color:#777;width:5%;margin:8px 0;">

<div id="controls">
  <span id="countdown">Countdown: 5/5 - Buffer: 50</span>
</div>

<!-- Buffer Slider -->
<div class="slider-container">
  <input type="range" id="bufferSlider" min="3" max="250" value="50">
</div>

<!-- Idle Timer Slider -->
<div class="slider-container">
  <input type="range" id="idleSlider" min="2" max="60" value="5">
</div>

<div id="textBox" class="box" contenteditable="true" spellcheck="false"></div>

<script>
const textBox = document.getElementById("textBox");
const countdownDisplay = document.getElementById("countdown");
const bufferSlider = document.getElementById("bufferSlider");
const idleSlider = document.getElementById("idleSlider");

let MAX_CHARS = parseInt(bufferSlider.value);
let IDLE_TIME_MS = parseInt(idleSlider.value) * 1000;

let idleTimer = null;
let countdownInterval = null;
let remainingSeconds = parseInt(idleSlider.value);

let fadeTimeout = null;

// Random letter/number functions
function randomLetter(isUpper) {
  const letters = "abcdefghijklmnopqrstuvwxyz";
  const l = letters[Math.floor(Math.random() * letters.length)];
  return isUpper ? l.toUpperCase() : l;
}

function randomNumber() {
  return Math.floor(Math.random() * 10).toString();
}

// Mask letters beyond buffer
function maskSingleChar() {
  const chars = textBox.innerText.split("");
  let count = 0;
  for (let c of chars) if (/[A-Za-z0-9]/.test(c)) count++;
  if (count <= MAX_CHARS) return;

  const target = count - MAX_CHARS;
  let seen = 0;
  for (let i = 0; i < chars.length; i++) {
    if (/[A-Za-z0-9]/.test(chars[i])) {
      seen++;
      if (seen === target) {
        if (/[A-Z]/.test(chars[i])) chars[i] = randomLetter(true);
        else if (/[a-z]/.test(chars[i])) chars[i] = randomLetter(false);
        else chars[i] = randomNumber();
        break;
      }
    }
  }
  textBox.innerText = chars.join("");
  moveCaretToEnd();
}

function moveCaretToEnd() {
  const r = document.createRange();
  r.selectNodeContents(textBox);
  r.collapse(false);
  const s = window.getSelection();
  s.removeAllRanges();
  s.addRange(r);
}

function fadeAndClear() {
  textBox.classList.add("fading");
  fadeTimeout = setTimeout(() => {
    textBox.innerText = "";
    textBox.classList.remove("fading");
    fadeTimeout = null;
    remainingSeconds = IDLE_TIME_MS / 1000;
    updateCountdownDisplay();
  }, 1500);
}

function cancelFade() {
  if (fadeTimeout !== null) {
    clearTimeout(fadeTimeout);
    fadeTimeout = null;
    textBox.classList.remove("fading");
  }
}

function updateCountdownDisplay() {
  countdownDisplay.textContent = `Countdown: ${remainingSeconds}/${IDLE_TIME_MS / 1000} - Buffer: ${MAX_CHARS}`;
}

function resetIdleTimer() {
  clearTimeout(idleTimer);
  clearInterval(countdownInterval);

  remainingSeconds = IDLE_TIME_MS / 1000;
  updateCountdownDisplay();

  countdownInterval = setInterval(() => {
    remainingSeconds--;
    updateCountdownDisplay();
    if (remainingSeconds <= 0) clearInterval(countdownInterval);
  }, 1000);

  idleTimer = setTimeout(fadeAndClear, IDLE_TIME_MS);
}

// Sliders
bufferSlider.addEventListener("input", () => {
  MAX_CHARS = parseInt(bufferSlider.value);
  updateCountdownDisplay();
  // immediately mask if over new buffer
  maskSingleChar();
});

idleSlider.addEventListener("input", () => {
  IDLE_TIME_MS = parseInt(idleSlider.value) * 1000;
  remainingSeconds = parseInt(idleSlider.value);
  // Reset countdown if user has typed
  if (textBox.innerText.length > 0) {
    resetIdleTimer();
  } else {
    updateCountdownDisplay();
  }
});

// Text box typing
textBox.addEventListener("input", () => {
  cancelFade();
  maskSingleChar();
  resetIdleTimer();
});

textBox.addEventListener("keydown", e => {
  if (e.key === "Enter") {
    e.preventDefault();
    clearTimeout(idleTimer);
    clearInterval(countdownInterval);
    fadeAndClear();
  }
});

// Focus on load
window.addEventListener("load", () => {
  textBox.focus();
  moveCaretToEnd();
  updateCountdownDisplay();
});
</script>

</body>
</html>
